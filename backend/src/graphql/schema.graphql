enum Role {
  ADMIN
  ENGINEER
  VIEWER
}

type User {
  id: ID!
  email: String!
  name: String!
  role: Role!
}

type AuthPayload {
  token: String!
  user: User!
}

type Turbine {
  id: ID!
  name: String!
  manufacturer: String
  mwRating: Float
  lat: Float
  lng: Float
  inspections: [Inspection!]!
  createdAt: String!
  updatedAt: String!
}

enum DataSource {
  DRONE
  MANUAL
}

type Inspection {
  id: ID!
  date: String!
  inspectorName: String
  dataSource: DataSource!
  rawPackageUrl: String
  turbine: Turbine!
  findings: [Finding!]!
  repairPlan: RepairPlan
  createdAt: String!
  updatedAt: String!
}

enum FindingCategory {
  BLADE_DAMAGE
  LIGHTNING
  EROSION
  UNKNOWN
}

type Finding {
  id: ID!
  category: FindingCategory!
  severity: Int!
  estimatedCost: Float!
  notes: String
  inspection: Inspection!
  createdAt: String!
  updatedAt: String!
}

enum Priority {
  LOW
  MEDIUM
  HIGH
}

type RepairPlan {
  id: ID!
  priority: Priority!
  totalEstimatedCost: Float!
  inspection: Inspection!
  snapshotJson: String
  createdAt: String!
  updatedAt: String!
}

type PaginatedTurbines {
  data: [Turbine!]!
  total: Int!
  limit: Int!
  offset: Int!
}

type PaginatedInspections {
  data: [Inspection!]!
  total: Int!
  limit: Int!
  offset: Int!
}

type Query {
  # Auth
  me: User
  
  # Turbines
  turbines(limit: Int, offset: Int): PaginatedTurbines!
  turbine(id: ID!): Turbine
  
  # Inspections
  inspections(
    turbineId: ID
    startDate: String
    endDate: String
    dataSource: DataSource
    limit: Int
    offset: Int
  ): PaginatedInspections!
  inspection(id: ID!): Inspection
  
  # Findings
  findings(inspectionId: ID!, searchNotes: String): [Finding!]!
  
  # Repair Plans
  repairPlan(inspectionId: ID!): RepairPlan
}

type Mutation {
  # Auth
  login(email: String!, password: String!): AuthPayload!
  
  # Turbines
  createTurbine(
    name: String!
    manufacturer: String
    mwRating: Float
    lat: Float
    lng: Float
  ): Turbine!
  
  updateTurbine(
    id: ID!
    name: String
    manufacturer: String
    mwRating: Float
    lat: Float
    lng: Float
  ): Turbine!
  
  deleteTurbine(id: ID!): Boolean!
  
  # Inspections
  createInspection(
    turbineId: ID!
    date: String!
    inspectorName: String
    dataSource: DataSource!
    rawPackageUrl: String
  ): Inspection!
  
  updateInspection(
    id: ID!
    date: String
    inspectorName: String
    dataSource: DataSource
    rawPackageUrl: String
  ): Inspection!
  
  deleteInspection(id: ID!): Boolean!
  
  # Findings
  createFinding(
    inspectionId: ID!
    category: FindingCategory!
    severity: Int!
    estimatedCost: Float!
    notes: String
  ): Finding!
  
  updateFinding(
    id: ID!
    category: FindingCategory
    severity: Int
    estimatedCost: Float
    notes: String
  ): Finding!
  
  deleteFinding(id: ID!): Boolean!
  
  # Repair Plans
  generateRepairPlan(inspectionId: ID!): RepairPlan!
}
